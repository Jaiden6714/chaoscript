-- FUN CHAOS MENU (Compact Wide Version with Invisible, TP Forward & FE Fly)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local lplr = Players.LocalPlayer
local mouse = lplr:GetMouse()

-- GUI
local gui = Instance.new("ScreenGui", lplr:WaitForChild("PlayerGui"))
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0,400,0,300) -- slightly taller for new buttons
main.Position = UDim2.new(0.5,-200,0.5,-150)
main.BackgroundColor3 = Color3.fromRGB(135,206,235) -- sky blue
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1,0,0,40)
title.BackgroundTransparency = 1
title.Text = "FUN CHAOS MENU"
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.TextColor3 = Color3.new(1,1,1)

-- Helper to make toggle buttons
local function MakeToggle(text, y, default, callback)
    local label = Instance.new("TextLabel", main)
    label.Size = UDim2.new(0.6,-10,0,25)
    label.Position = UDim2.new(0,10,0,y)
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.Text = text

    local toggle = Instance.new("TextButton", main)
    toggle.Size = UDim2.new(0.3,0,0,25)
    toggle.Position = UDim2.new(0.65,10,0,y)
    toggle.BackgroundColor3 = default and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
    toggle.Text = default and "ON" or "OFF"
    toggle.TextColor3 = Color3.new(1,1,1)
    toggle.Font = Enum.Font.GothamBold
    toggle.TextSize = 14
    Instance.new("UICorner", toggle).CornerRadius = UDim.new(0,5)

    local state = default
    toggle.MouseButton1Click:Connect(function()
        state = not state
        toggle.BackgroundColor3 = state and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
        toggle.Text = state and "ON" or "OFF"
        callback(state)
    end)
end

-- Noclip
local noclipActive = false
MakeToggle("Noclip",50,false,function(val) noclipActive=val end)
RunService.Stepped:Connect(function()
    if noclipActive and lplr.Character then
        for _,part in pairs(lplr.Character:GetChildren()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

-- FE Fly
local flyActive = false
local flySpeed = 50
local bodyPos, bodyGyro

MakeToggle("Fly",85,false,function(val)
    flyActive = val
    local char = lplr.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local hrp = char.HumanoidRootPart
        if flyActive then
            bodyPos = Instance.new("BodyPosition")
            bodyPos.MaxForce = Vector3.new(1e5,1e5,1e5)
            bodyPos.Position = hrp.Position
            bodyPos.Parent = hrp

            bodyGyro = Instance.new("BodyGyro")
            bodyGyro.MaxTorque = Vector3.new(1e5,1e5,1e5)
            bodyGyro.CFrame = hrp.CFrame
            bodyGyro.Parent = hrp
        else
            if bodyPos then bodyPos:Destroy() bodyPos=nil end
            if bodyGyro then bodyGyro:Destroy() bodyGyro=nil end
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if flyActive and bodyPos and bodyGyro and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = lplr.Character.HumanoidRootPart
        local cam = workspace.CurrentCamera
        local direction = Vector3.new()

        if UIS:IsKeyDown(Enum.KeyCode.W) then direction += cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then direction -= cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then direction -= cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then direction += cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then direction += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then direction -= Vector3.new(0,1,0) end

        if direction.Magnitude > 0 then
            bodyPos.Position = hrp.Position + direction.Unit * flySpeed * RunService.RenderStepped:Wait()
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + direction)
        end
    end
end)

-- Teleport to mouse
MakeToggle("TP to Mouse",120,false,function(val)
    if val and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
        local mousePos = mouse.Hit.Position + Vector3.new(0,5,0)
        lplr.Character.HumanoidRootPart.CFrame = CFrame.new(mousePos)
    end
end)

-- Spawn point
local spawnPos
MakeToggle("Set Spawn Point",155,false,function(val)
    if val and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
        spawnPos = lplr.Character.HumanoidRootPart.Position
    end
end)

MakeToggle("Respawn at Spawn",190,false,function(val)
    if val and spawnPos then
        lplr.Character:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(spawnPos)
    end
end)

-- Invisible
local invisibleActive = false
MakeToggle("Invisible",225,false,function(val)
    invisibleActive = val
    if lplr.Character then
        for _,part in pairs(lplr.Character:GetChildren()) do
            if part:IsA("BasePart") then
                part.Transparency = invisibleActive and 1 or 0
            elseif part:IsA("Decal") or part:IsA("Texture") then
                part.Transparency = invisibleActive and 1 or 0
            end
        end
    end
end)

-- Teleport Forward (5 studs)
MakeToggle("Teleport Forward",260,false,function(val)
    if val and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = lplr.Character.HumanoidRootPart
        hrp.CFrame = hrp.CFrame + hrp.CFrame.LookVector * 5
    end
end)

-- Desync (might work)
local desyncActive = false
MakeToggle("Desync (might work)",295,false,function(val)
    desyncActive = val
    if lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
        lplr.Character.HumanoidRootPart.Anchored = desyncActive
    end
end)
